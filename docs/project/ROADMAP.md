# BrepFlow Roadmap

*Org:* **Aureo Labs / MADFAM**  
*Product:* **BrepFlow** – Web-first, node-based parametric CAD  
*Status:* Updated 2025-01-30 · Maintainer: Core Platform Team

> This roadmap reflects the current, shipping reality of the codebase as of January 2025. It replaces prior aspirational planning. Timelines are indicative; execution depends on resourcing and unlocking core technical debt called out below.

---

## 0. Snapshot — Where We Are Today

| Area | Reality | Confidence |
| --- | --- | --- |
| Geometry backend | Studio and CLI now evaluate via OCCT.wasm. Primitives, booleans, fillets, tessellation, and STEP/STL/IGES export work end-to-end. Performance tuning and edge-case recovery remain. | ✅ Medium |
| Node catalogue | Legacy handcrafted nodes work, while the generated 1k-node catalogue still fails type checking and is disabled. Enhanced registry remains scaffolding. | ⚠️ Low |
| Type safety | Geometry packages compile cleanly. Root `pnpm typecheck` still fails inside the collaboration package pending OT/type migration. | ⚠️ Medium |
| Studio app | Graph editing, undo/redo, and viewport now operate on real geometry. Collaboration, analytics, and monitoring panes are still placeholders. | ⚠️ Medium |
| Testing | Playwright suites still rely on injected mocks and do not exercise the real Studio surface. Integration coverage for the OCCT pipeline is minimal. | ⚠️ Low |
| Tooling | Dist artefacts removed and tsup emits declarations. Repo still contains legacy assets (`coverage/`, `artifacts/`) that should be trimmed. | ⚠️ Medium |

**Primary objective for 2025 Q1:** harden the real-geometry pipeline (performance, error handling, tests) and unblock node catalogue + collaboration workstreams.

---

## 1. Strategic Themes (2025)

1. **Harden the geometry pipeline.** Optimise OCCT performance, add diagnostics, and improve failure handling now that real bindings are in place.
2. **Stabilise the node platform.** Fix the generator, align type definitions, and guarantee nodes register cleanly before exposing the catalogue.
3. **Rebuild confidence in tooling.** Restore type checking across the monorepo and rebuild automated tests without mock-heavy shortcuts.
4. **Polish Studio UX around the supported surface.** Focus on graph editing, evaluation lifecycle, and viewport fidelity; defer diagnostics/marketplace work until the core is solid.
5. **Sequence ecosystem work last.** Plugin SDK, collaboration, and marketplace move to backlog until geometry + nodes + testing are proven.

---

## 2. Horizon Plan

### Horizon A — Geometry Hardening (target: 2025-03)

**Goal:** Stabilise the newly wired OCCT pipeline: performance, diagnostics, error recovery, and type coverage before opening the floodgates to more nodes and collaboration.

| Workstream | Key Tasks | Exit Criteria |
| --- | --- | --- |
| OCCT performance & recovery | - Profile primitives/booleans across reference models<br>- Add operation-level diagnostics and timing<br>- Implement graceful recovery for failed OCCT calls | P95 evaluation time ≤ 1.5 s on reference assemblies; failures surface actionable errors, not placeholder output. |
| CLI & Studio alignment | - Ensure Studio/CLI share the same geometry API<br>- Remove final mock fallbacks and pointer caches<br>- Add structured error propagation and logging | Graph evaluation fails loudly on geometry errors; CLI smoke renders pass with real STEP output. |
| Autogenerated node catalogue | - Fix generator templates (ids, socket specs, imports)<br>- Compile generated catalogue via dedicated CI step (`pnpm build`)<br>- Gate Studio palette on validated catalogue output | Generated catalogue compiles in CI; `pnpm build` passes cleanly before palette toggles; all registered types have working evaluate handlers. |
| Type safety & artefact hygiene | - Keep dist artefacts out of the tree<br>- Restore required CI gates for `pnpm typecheck` (collaboration excluded) and `pnpm lint`<br>- Document OCCT build requirements and troubleshooting | CI runs and passes `pnpm typecheck`/`pnpm lint`; repo remains artefact-free; docs walk developers through OCCT build setup. |

**Dependencies:** OCCT wasm artefacts available (`packages/engine-occt/wasm`), build farm with emsdk.

### Horizon B — Production-Ready Surfaces (target: 2025-06)

**Goal:** Polish the core experience now that geometry is real. Ship a credible `v0.2` focused on reliability and editor usability.

| Workstream | Key Tasks | Exit Criteria |
| --- | --- | --- |
| Viewport & performance | - Hook tessellation output to Three.js geometry<br>- Implement basic LOD/triangulation controls<br>- Instrument worker memory, caching, and cancellation | P95 evaluation time on reference assemblies ≤ 1.5 s; viewport maintains 30 FPS on M2 Air. |
| Graph UX & inspector | - Simplify inspector to match actual node params<br>- Add inline validation and error badges<br>- Finalise undo/redo persistence strategy | Pilot designers complete provided tutorials without relying on console/hidden APIs; telemetry shows <5% evaluation errors per session. |
| Testing uplift | - Replace synthetic Playwright flows with real Studio E2E covering create → evaluate → export<br>- Stand up integration tests for node evaluation + geometry<br>- Generate minimal golden outputs | Nightly E2E suite exercises real geometry and fails on regressions; coverage summary published without manual steps. |
| Documentation | - Rewrite README and docs to match real functionality<br>- Provide troubleshooting for OCCT build + runtime errors<br>- Document supported/import/export nodes | Public docs no longer promise plugins or marketplace; onboarding guide leads to successful render. |

### Horizon C — Ecosystem Foundations (target: 2025-10, stretch)

**Goal:** Once core is trustworthy, selectively add collaboration and extensibility.

| Workstream | Key Tasks | Exit Criteria |
| --- | --- | --- |
| Collaboration MVP | - Replace placeholder socket.io server with audited OT layer<br>- Ship presence/locking with tests<br>- Add telemetry & logging | Two internal teams co-edit sample project without data loss; conflict rate <2 per 10 sessions. |
| Plugin SDK scope cut | - Define minimal plugin API (custom nodes only)<br>- Harden sandboxing (no fake `window.mock*` helpers)<br>- Build example plugin + packaging tool | Third-party node runs with enforced permissions; security review passes. |
| Marketplace/registry (optional) | - Only after SDK solid<br>- Build simple hosted index | Deferred unless prior themes complete. |

---

## 3. Cross-Cutting Initiatives

- **Quality Gates (ongoing):** Block merges on failing type checks, lint, unit tests, integration tests. Keep `pnpm audit:full` optional until Playwright suite is realigned.
- **Observability (DAG/OCCT workers):** Instrument DAG engine and OCCT workers for evaluation timing, cache hits, and critical errors. Surface metrics in logs first; dashboards later.
- **Security & Compliance hardening:** Ensure OCCT wasm loading respects COOP/COEP, CSP. Audit CLI for sandbox escapes. Postpone signed plugin registry until Horizon C.
- **Resourcing:**
  - 1 × C++/Emscripten engineer (OCCT bindings, export pipeline)
  - 1 × TypeScript/React engineer (Studio + node generator)
  - Shared QA/devops for CI, automation, and release packaging

---

## 4. Risks & Mitigations

| Risk | Impact | Mitigation |
| --- | --- | --- |
| OCCT wasm performance inadequate in browser | Without threading/SharedArrayBuffer the MVP stalls | Validate with small pilot assemblies first; consider offloading heavy exports to CLI / native runner. |
| Generated nodes remain unverified | Studio crashes or produces nonsense geometry | Gate palette by whitelist until generator passes CI. Add property-based tests for node params. |
| Test debt hides regressions | False sense of security from mock-based suites | Replace mocks gradually; stage new E2E suites alongside legacy before retiring. |
| Resourcing gaps | Slips across horizons | Prioritise Horizon A. Defer ecosystem promises publicly until staffing confirmed. |

---

## 5. Communication Cadence

- **Weekly core sync:** Geometry + Studio teams share progress on Horizon A tasks.
- **Bi-weekly demo:** Showcase tangible improvements (real STEP export, node validation).
- **Monthly roadmap review:** Adjust horizons based on delivery, update this document accordingly.
- **Public changelog:** Once Horizon A complete, publish honest release notes alongside web updates.

---

## 6. Immediate Next Steps (Feb 2025)

1. Land tsup/typecheck fix and remove tracked artefacts (`dist/`, `coverage/`, etc.).
2. Replace placeholder returns in `RealOCCT` export/tessellation paths with real WASM calls; add integration test in CLI.
3. Patch node generator templates and add CI job to compile generated nodes.
4. Update README and marketing copy to reflect current capabilities (mock geometry, limited nodes) until Horizon A concludes.

---

*Document history: rebuilt from scratch January 2025 to reflect actual status. Prior aspirational phases archived in git history.*
